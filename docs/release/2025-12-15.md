# Release Notes - v1.0.4 (December 15, 2025)

## üéâ New Features

### Branch Selection
- **Automatic Branch Discovery**: The connector now fetches available branches from your repository automatically
- **New API Endpoint**: `GET /repositories/:id/branches` - Retrieve all branches for a repository
- **Frontend Integration**: Branch dropdown in test-app automatically populates with available branches
- **Smart Fallback**: If branches can't be loaded, falls back to manual text input

### Improved Run Polling
- **Smart Polling**: Polling automatically stops when a run reaches terminal states (`canceling` or `completed`)
- **Resource Efficient**: Prevents unnecessary API calls after run completion
- **Better UX**: Clearer indication of run lifecycle states

## üîß Technical Improvements

### API Enhancements
- Added `listBranches(repositoryId: string)` method to `AdoClient`
- New route handler for `/repositories/:id/branches` endpoint
- Enhanced error handling with proper status codes (400 for invalid IDs)

### Frontend Updates
- Branch selection dropdown with auto-population
- Polling logic now respects terminal run states
- Improved state management for branch loading

## üêõ Bug Fixes
- Fixed 405 Method Not Allowed error by switching to Builds API for cancellation
- Added proper validation for Pipeline ID and Run ID (returns 400 instead of 500)
- Improved error logging for better debugging

## üìù API Changes

### New Endpoints
```typescript
// Get branches for a repository
GET /api/ado/repositories/:repositoryId/branches

// Response format
[
  { name: "main", ref: "refs/heads/main" },
  { name: "develop", ref: "refs/heads/develop" }
]
```

### Updated Behavior
- `PATCH /api/ado/pipelines/:id/runs/:runId` now uses Builds API internally
- Polling stops automatically when state is `canceling` or `completed`

## üîÑ Migration Guide

### From v1.0.3 to v1.0.4

No breaking changes! This is a backward-compatible release.

**Optional Updates:**
1. Update your API route to export `PATCH` if not already done:
```typescript
export { handler as GET, handler as POST, handler as PATCH };
```

2. If using the test-app, branches will now auto-populate when you enter a Pipeline ID

## üì¶ Installation

```bash
npm install ado-connector@1.0.4
# or
yarn add ado-connector@1.0.4
```

## üôè Acknowledgments

Thanks to all contributors and users who provided feedback for this release!
